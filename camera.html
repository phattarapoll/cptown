<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Camera & Recorder</title>
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #121212;
            color: white;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        #camera-container {
            position: relative;
            width: 100vw;
            height: 65vh;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        video {
            height: 100%;
            width: 100%;
            object-fit: contain;
        }

        .controls-panel {
            width: 100%;
            padding: 20px;
            background: #1e1e1e;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            border-top: 1px solid #333;
        }

        .input-group {
            width: 85%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .row { display: flex; align-items: center; gap: 15px; }
        
        input[type=range] { flex-grow: 1; }
        input[type=text] { 
            padding: 10px; 
            border-radius: 8px; 
            border: 1px solid #444; 
            background: #2c2c2c; 
            color: white;
            flex-grow: 1;
        }

        .button-group {
            display: flex;
            gap: 15px;
        }

        button {
            padding: 15px 40px;
            border-radius: 50px;
            border: none;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: 0.2s;
        }

        #capture-btn {
            background: linear-gradient(135deg, #00dbde, #fc00ff);
        }

        #record-btn {
            background: #444;
        }

        /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ï‡∏≠‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å */
        #record-btn.recording {
            background: #ff4b2b;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); }
        }

        button:active { transform: scale(0.95); }
        canvas { display: none; }
    </style>
</head>
<body>

    <div id="camera-container">
        <video id="webcam" autoplay playsinline muted></video>
    </div>

    <div class="controls-panel">
        <div class="input-group">
            <div class="row">
                <span>üîÖ ‡πÅ‡∏™‡∏á</span>
                <input type="range" id="brightness" min="0.8" max="2.0" step="0.1" value="1.2">
            </div>
            <div class="row">
                <span>‚úçÔ∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span>
                <input type="text" id="overlay-text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏™‡πà‡∏†‡∏≤‡∏û‡∏ñ‡πà‡∏≤‡∏¢..." value="">
            </div>
        </div>

        <div class="button-group">
            <button id="capture-btn">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û</button>
            <button id="record-btn">‚è∫Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</button>
        </div>
    </div>

    <canvas id="out-canvas"></canvas>

    <script>
        const video = document.getElementById('webcam');
        const canvas = document.getElementById('out-canvas');
        const brightnessSlider = document.getElementById('brightness');
        const textInput = document.getElementById('overlay-text');
        const captureBtn = document.getElementById('capture-btn');
        const recordBtn = document.getElementById('record-btn');

        let mediaRecorder;
        let recordedChunks = [];
        let stream;

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á
        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { width: { ideal: 1920 }, height: { ideal: 1080 } },
                    audio: true 
                });
                video.srcObject = stream;
            } catch (err) {
                alert("‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + err);
            }
        }

        // ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á Preview
        brightnessSlider.oninput = () => {
            video.style.filter = `brightness(${brightnessSlider.value})`;
        };

        // --- ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û ---
        captureBtn.onclick = () => {
            const ctx = canvas.getContext('2d');
            const w = video.videoWidth;
            const h = video.videoHeight;
            canvas.width = w;
            canvas.height = h;

            ctx.filter = `brightness(${brightnessSlider.value})`;
            ctx.drawImage(video, 0, 0, w, h);

            ctx.globalAlpha = 0.2;
            ctx.filter = `blur(${w/200}px) brightness(${brightnessSlider.value})`;
            ctx.drawImage(video, 0, 0, w, h);
            ctx.globalAlpha = 1.0;
            ctx.filter = "none";

            const fontSize = Math.floor(h / 25);
            ctx.font = `bold ${fontSize}px Kanit, sans-serif`;
            ctx.fillStyle = "white";
            ctx.textAlign = "center";
            ctx.shadowColor = "rgba(0, 0, 0, 0.8)";
            ctx.shadowBlur = 10;
            ctx.fillText(textInput.value, w / 2, h - (h * 0.05));

            const link = document.createElement('a');
            link.download = `PIC_DENT_${Date.now()}.jpg`;
            link.href = canvas.toDataURL('image/jpeg', 0.95);
            link.click();
        };

        // --- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ---
        recordBtn.onclick = () => {
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
            } else {
                startRecording();
            }
        };

        function startRecording() {
            recordedChunks = [];
            mediaRecorder = new MediaRecorder(stream);

            mediaRecorder.ondataavailable = (e) => {
                if (e.data.size > 0) recordedChunks.push(e.data);
            };

            mediaRecorder.onstop = () => {
                const blob = new Blob(recordedChunks, { type: 'video/webm' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `VIDEO_DENT_${Date.now()}.webm`;
                link.click();
                
                recordBtn.innerText = "‚è∫Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠";
                recordBtn.classList.remove('recording');
            };

            mediaRecorder.start();
            recordBtn.innerText = "‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å";
            recordBtn.classList.add('recording');
        }

        startCamera();
    </script>
</body>
</html>