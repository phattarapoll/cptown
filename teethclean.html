<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏ì‡∏£‡∏á‡∏Ñ‡πå</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        body { 
            background-color: #f8f9fa; 
            padding: 20px; 
            font-family: 'Sarabun', sans-serif;
        }
        .container-fluid { 
            max-width: 1400px;
            margin-top: 30px; 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        }
        h2 { color: #2c3e50; font-weight: bold; }
        
        table { font-size: 0.9rem; }
        thead th { 
            background-color: #e9ecef !important;
            text-align: center;
            vertical-align: middle;
            border: 1px solid #dee2e6;
        }
        tbody td {
            vertical-align: middle;
        }
        /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÅ‡∏•‡∏∞‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢ ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á */
        tbody td:not(:nth-child(2)):not(:nth-child(3)) {
            text-align: center;
        }

        /* ******* ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏ã‡πà‡∏≠‡∏ô ******* */
        #chart-container {
            display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
        }
        #chart-toggle-button {
            position: fixed;
            top: 50%; /* ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ */
            right: 20px;
            transform: translateY(-50%);
            z-index: 1000;
            cursor: pointer;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-size: 1.2rem;
            line-height: 50px;
            text-align: center;
        }
        /* ******* ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ******* */
    </style>
</head>
<body>

    <div class="container-fluid">
        <h2 class="text-center mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏ì‡∏£‡∏á‡∏Ñ‡πå "‡∏ü‡∏±‡∏ô‡∏™‡∏∞‡∏≠‡∏≤‡∏î ‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á"</h2>
        
        <div id="loading" class="text-center my-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet...</p>
        </div>

        <div id="chart-container" class="mb-5">
            <h3 class="text-center mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ä‡πà‡∏≠‡∏á‡∏õ‡∏≤‡∏Å (‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°)</h3>
            <canvas id="summaryChart"></canvas>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered table-hover d-none" id="data-table">
                <thead>
                    <tr>
                        <th rowspan="2" width="5%">‡∏•‡∏≥‡∏î‡∏±‡∏ö<br>‡∏ó‡∏µ‡πà</th>
                        <th rowspan="2" width="10%">‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</th>
                        <th rowspan="2" width="15%">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                        <th rowspan="2" width="10%">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô<br>‡∏°.1 ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î<br>(‡∏Ñ‡∏ô)</th>
                        <th colspan="4">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</th>
                        <th rowspan="2" width="10%">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ<br>‡∏´‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏•‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠<br>‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö<br>(‡∏Ñ‡∏ô)</th>
                        <th rowspan="2" width="10%">‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/<br>‡πÑ‡∏°‡πà‡∏£‡πà‡∏ß‡∏°<br>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°<br>(‡∏Ñ‡∏ô)</th>
                    </tr>
                    <tr>
                        <th>‡∏ü‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏™‡∏µ<br>(‡∏Ñ‡∏ô)</th>
                        <th>‡∏ü‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏™‡∏µ 1-5 ‡∏ã‡∏µ‡πà<br>(‡∏Ñ‡∏ô)</th>
                        <th>‡∏ü‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏™‡∏µ<br>‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ã‡∏µ‡πà (‡∏Ñ‡∏ô)</th>
                        <th>‡∏£‡∏ß‡∏°<br>(‡∏Ñ‡∏ô)</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    </tbody>
            </table>
        </div>
    </div>

    <button id="chart-toggle-button" class="btn btn-primary" title="‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏≤‡∏ü">
        üìä
    </button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRG13hmk9VPDlyXieo8Msgf0bSpkSkm7UrB5RlZTE6Q7bT-N-JaajlcDu-0vYjnmg/pub?gid=1801181500&single=true&output=csv';
        const START_ROW_INDEX = 8; 

        let allData = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü

        function fetchData() {
            Papa.parse(CSV_URL, {
                download: true,
                header: false, 
                complete: function(results) {
                    if (results.data && results.data.length > START_ROW_INDEX) {
                        allData = results.data.slice(START_ROW_INDEX);
                        processData(results.data);
                        initChart(allData); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß
                    } else {
                        displayError('‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á');
                    }
                },
                error: function(err) {
                    console.error("Error:", err);
                    displayError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS ‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á)');
                }
            });
        }

        function displayError(message) {
            document.getElementById('loading').innerHTML = `<span class="text-danger">${message}</span>`;
        }

        function processData(data) {
            const table = document.getElementById('data-table');
            const tbody = document.getElementById('table-body');
            const loading = document.getElementById('loading');

            loading.style.display = 'none';
            table.classList.remove('d-none');

            const realData = data.slice(START_ROW_INDEX); 
            let bodyRows = '';
            
            realData.forEach(row => {
                if (row[0] && row[0].trim() !== '' && row.length >= 10) {
                    bodyRows += `
                        <tr>
                            <td>${row[0]}</td> <td>${row[1]}</td> <td class="text-start">${row[2]}</td> <td>${row[3] || 0}</td> <td>${row[4] || 0}</td> <td>${row[5] || 0}</td> <td>${row[6] || 0}</td> <td class="fw-bold table-light">${row[7] || 0}</td> <td>${row[8] || 0}</td> <td class="text-danger">${row[9] || 0}</td> </tr>
                    `;
                }
            });

            tbody.innerHTML = bodyRows;
        }

        // ******* ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏° *******

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏£‡∏ß‡∏°
        function calculateSummary(data) {
            let totalNoStain = 0; // ‡∏ü‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏™‡∏µ (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 4 ‡∏´‡∏£‡∏∑‡∏≠ Index 4)
            let totalStain1_5 = 0; // ‡∏ü‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏™‡∏µ 1-5 ‡∏ã‡∏µ‡πà (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 5 ‡∏´‡∏£‡∏∑‡∏≠ Index 5)
            let totalStainOver5 = 0; // ‡∏ü‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏™‡∏µ ‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ã‡∏µ‡πà (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 6 ‡∏´‡∏£‡∏∑‡∏≠ Index 6)
            let totalPlaque = 0; // ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏•‡∏≤‡∏¢/‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 8 ‡∏´‡∏£‡∏∑‡∏≠ Index 8)
            let totalParticipated = 0; // ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 7 ‡∏´‡∏£‡∏∑‡∏≠ Index 7)

            data.forEach(row => {
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÅ‡∏ñ‡∏ß‡∏ô‡∏±‡πâ‡∏ô‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠
                if (row[0] && row[0].trim() !== '' && row.length >= 10) {
                    totalNoStain += parseInt(row[4] || 0);
                    totalStain1_5 += parseInt(row[5] || 0);
                    totalStainOver5 += parseInt(row[6] || 0);
                    totalParticipated += parseInt(row[7] || 0);
                    totalPlaque += parseInt(row[8] || 0);
                }
            });

            return { totalNoStain, totalStain1_5, totalStainOver5, totalPlaque, totalParticipated };
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü
        function initChart(data) {
            const summary = calculateSummary(data);
            const ctx = document.getElementById('summaryChart').getContext('2d');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['‡∏ü‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏™‡∏µ', '‡∏ï‡∏¥‡∏î‡∏™‡∏µ 1-5 ‡∏ã‡∏µ‡πà', '‡∏ï‡∏¥‡∏î‡∏™‡∏µ > 5 ‡∏ã‡∏µ‡πà', '‡∏°‡∏µ‡∏´‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏•‡∏≤‡∏¢/‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö'],
                    datasets: [{
                        label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏Ñ‡∏ô)',
                        data: [
                            summary.totalNoStain, 
                            summary.totalStain1_5, 
                            summary.totalStainOver5,
                            summary.totalPlaque
                        ],
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.6)', // ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏™‡∏µ (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)
                            'rgba(255, 206, 86, 0.6)', // 1-5 ‡∏ã‡∏µ‡πà (‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á)
                            'rgba(255, 99, 132, 0.6)', // > 5 ‡∏ã‡∏µ‡πà (‡πÅ‡∏î‡∏á)
                            'rgba(54, 162, 235, 0.6)'  // ‡∏´‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏•‡∏≤‡∏¢/‡πÄ‡∏´‡∏á‡∏∑‡∏≠‡∏Å (‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô)
                        ],
                        borderColor: [
                            'rgba(75, 192, 192, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: `‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${summary.totalParticipated} ‡∏Ñ‡∏ô`
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏Ñ‡∏ô)'
                            }
                        }
                    }
                }
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏£‡∏≤‡∏ü
        function toggleChart() {
            const chartContainer = document.getElementById('chart-container');
            const button = document.getElementById('chart-toggle-button');
            
            if (chartContainer.style.display === 'none') {
                chartContainer.style.display = 'block';
                button.classList.remove('btn-primary');
                button.classList.add('btn-danger');
                button.innerHTML = '‚ùå'; // ‡∏õ‡∏¥‡∏î
                button.title = '‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏≤‡∏ü';
            } else {
                chartContainer.style.display = 'none';
                button.classList.remove('btn-danger');
                button.classList.add('btn-primary');
                button.innerHTML = 'üìä'; // ‡πÄ‡∏õ‡∏¥‡∏î
                button.title = '‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü';
            }
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏° Event Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°
        document.addEventListener('DOMContentLoaded', () => {
            const button = document.getElementById('chart-toggle-button');
            if (button) {
                button.addEventListener('click', toggleChart);
            }
        });
        
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        fetchData();
        // ******* ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° *******
    </script>
</body>
</html>